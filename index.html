<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶≤‡ßã‡¶°‡¶∂‡ßá‡¶°‡¶ø‡¶Ç ‡¶∞‡¶ø‡¶ï‡¶≠‡¶æ‡¶∞‡¶ø - Fixed Version</title>
<style>
  body, html { margin:0; padding:0; height:100%; font-family:sans-serif; background:#071126; overflow:hidden; }
  .container { display:flex; height:100%; width:100%; }
  .sidebar { width:280px; background:rgba(0,0,0,0.3); border-right:2px solid #0ff; padding:10px; box-sizing:border-box; display:flex; flex-direction:column; gap:10px; }
  .sidebar button { padding:10px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; background:#0ff; color:#000; transition:0.2s; }
  .sidebar button:hover { transform:scale(1.05); box-shadow:0 0 15px #0ff; }
  .game-area { flex:1; position:relative; overflow:hidden; }
  .target { position:absolute; background-size:contain; background-repeat:no-repeat; cursor:pointer; }
  #fuse { width:120px; height:180px; left:6%; top:24%; background-image:url('assets/fuse_box.png'); }
  #cat { width:120px; height:120px; left:40%; top:38%; background-image:url('assets/cat.png'); display:none; }
  #meter { width:150px; height:150px; left:68%; top:56%; background-image:url('assets/meter_box.png'); display:none; }
  #pole { width:120px; height:220px; left:46%; top:8%; background-image:url('assets/pole.png'); display:none; }
  #flash { position:absolute; inset:0; z-index:30; pointer-events:auto; }
  canvas { position:absolute; inset:0; z-index:20; pointer-events:none; }
  .hint { position:absolute; bottom:20px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.5); color:#0ff; padding:8px 16px; border-radius:20px; font-size:14px; border:1px solid #0ff; z-index:40; }
  .overlay { position:absolute; inset:0; background:rgba(0,0,0,0.8); display:flex; justify-content:center; align-items:center; z-index:50; }
  .overlay-box { background:linear-gradient(to bottom,#00131a,#001b22); padding:20px; border-radius:16px; text-align:center; border:2px solid #0ff; max-width:400px; }
  .overlay-box h2 { color:#0ff; font-size:24px; margin-bottom:10px; }
  .overlay-box p { color:#fff; margin-bottom:15px; }
  .overlay-box button { margin:5px; padding:10px 15px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; background:#0ff; color:#000; transition:0.2s; }
  .overlay-box button:hover { transform:scale(1.05); box-shadow:0 0 15px #0ff; }
</style>
</head>
<body>
<div class="container">
  <!-- Sidebar -->
  <div class="sidebar">
    <button id="startBtn">üéÆ START</button>
    <button id="saveBtn">üíæ ‡¶∏‡ßá‡¶≠</button>
    <button id="loadBtn">üìÇ ‡¶≤‡ßã‡¶°</button>
    <button id="resetBtn">‚ôªÔ∏è ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
    <button id="soundBtn">üîä ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ON</button>
    <button id="creditsBtn">‚ú® Developed by AHSAN HABIB</button>
  </div>

  <!-- Game Area -->
  <div class="game-area" id="gameArea">
    <div id="fuse" class="target"></div>
    <div id="cat" class="target"></div>
    <div id="meter" class="target"></div>
    <div id="pole" class="target"></div>
    <canvas id="particles"></canvas>
    <div id="flash"></div>
    <div class="hint" id="hint">‡¶Æ‡¶æ‡¶â‡¶∏/‡¶Ü‡¶ô‡ßÅ‡¶≤ ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂‡¶≤‡¶æ‡¶á‡¶ü ‡¶®‡¶ø‡ßü‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</div>
  </div>
</div>

<!-- Overlay -->
<div class="overlay" id="overlay">
  <div class="overlay-box">
    <h2>‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
    <p>‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶õ‡¶ø‡¶≤‡ßá, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶π‡¶†‡¶æ‡ßé ‡¶ï‡¶∞‡ßá electricity ‡¶ö‡¶≤‡ßá ‡¶ó‡ßá‡¶õ‡ßá! ‡¶ï‡¶æ‡¶ú ‡¶∂‡ßá‡¶∑ ‡¶ï‡¶∞‡¶§‡ßá START ‡¶ö‡¶æ‡¶™‡ßÅ‡¶®‡•§</p>
    <button id="overlayStart">üéÆ START</button>
  </div>
</div>

<script>
const startBtn = document.getElementById('startBtn');
const overlayStart = document.getElementById('overlayStart');
const saveBtn = document.getElementById('saveBtn');
const loadBtn = document.getElementById('loadBtn');
const resetBtn = document.getElementById('resetBtn');
const soundBtn = document.getElementById('soundBtn');
const creditsBtn = document.getElementById('creditsBtn');
const overlay = document.getElementById('overlay');
const hint = document.getElementById('hint');
const gameArea = document.getElementById('gameArea');
const flash = document.getElementById('flash');
const particlesCanvas = document.getElementById('particles');
const ctx = particlesCanvas.getContext('2d');
let raf;

// Game state
let running=false, step=0, soundsOn=true;
let found={fuse:false,cat:false,meter:false,pole:false};
let particleStore=[];

// Ambient music
let ambient = new Audio('assets/mission_loop.mp3'); ambient.loop=true;

// Resize canvas
function resizeCanvas(){ particlesCanvas.width=gameArea.clientWidth; particlesCanvas.height=gameArea.clientHeight; }
window.addEventListener('resize',resizeCanvas); resizeCanvas();

// Hint function
function typeHint(msg, ms=2500){ hint.textContent=msg; setTimeout(()=>{ hint.textContent='‡¶Æ‡¶æ‡¶â‡¶∏/‡¶Ü‡¶ô‡ßÅ‡¶≤ ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂‡¶≤‡¶æ‡¶á‡¶ü ‡¶®‡¶ø‡ßü‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®'; }, ms); }

// Flashlight
gameArea.addEventListener('mousemove',(e)=>{
  flash.style.background=`radial-gradient(circle 160px at ${e.offsetX}px ${e.offsetY}px, rgba(255,255,230,0.95), rgba(0,0,0,0) 40%), radial-gradient(circle 360px at ${e.offsetX}px ${e.offsetY}px, rgba(255,255,255,0.04), rgba(0,0,0,0.92) 60%)`;
});
gameArea.addEventListener('touchmove',(e)=>{
  flash.style.background=`radial-gradient(circle 160px at ${e.touches[0].clientX}px ${e.touches[0].clientY}px, rgba(255,255,230,0.95), rgba(0,0,0,0) 40%), radial-gradient(circle 360px at ${e.touches[0].clientX}px ${e.touches[0].clientY}px, rgba(255,255,255,0.04), rgba(0,0,0,0.92) 60%)`;
});

// Particles
function spawnSparks(x,y,n=12){
  for(let i=0;i<n;i++){
    particleStore.push({x,y,vx:(Math.random()-0.5)*3,vy:(Math.random()-1.8)*3,life:30+Math.random()*30,size:1+Math.random()*2,color:`rgba(255,${150+Math.floor(Math.random()*100)},0,1)`});
  }
}
function tickParticles(){
  ctx.clearRect(0,0,particlesCanvas.width,particlesCanvas.height);
  for(let i=particleStore.length-1;i>=0;i--){
    const p=particleStore[i];
    p.x+=p.vx; p.y+=p.vy; p.vy+=0.06; p.life--;
    ctx.beginPath(); ctx.globalAlpha=Math.max(0,p.life/60); ctx.fillStyle=p.color;
    ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill();
    if(p.life<=0) particleStore.splice(i,1);
  }
  raf=requestAnimationFrame(tickParticles);
}
tickParticles();

// Update object visibility based on step
function updateVisibility(){
  document.getElementById('fuse').style.display = step>=1 ? 'block' : 'block';
  document.getElementById('cat').style.display = step>=1.5 ? 'block' : 'none';
  document.getElementById('meter').style.display = step>=2 ? 'block' : 'none';
  document.getElementById('pole').style.display = step>=3 ? 'block' : 'none';
}

// Button actions
function startGame(){ overlay.style.display='none'; running=true; step=1; typeHint('‡¶≤‡ßã‡¶°‡¶∂‡ßá‡¶°‡¶ø‡¶Ç ‡¶π‡ßü‡ßá‡¶õ‡ßá ‚Äî ‡¶´‡¶ø‡¶â‡¶ú ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®!'); if(soundsOn) ambient.play().catch(()=>{}); updateVisibility(); }
function saveGame(){ localStorage.setItem('ls_save',JSON.stringify({step,found})); typeHint('‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá'); }
function loadGame(){ const raw=localStorage.getItem('ls_save'); if(!raw){typeHint('‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡ßá‡¶≠ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø'); return;} const s=JSON.parse(raw); step=s.step||1; found=s.found||found; typeHint('‡¶∏‡ßá‡¶≠ ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡ßá‡¶õ‡ßá'); updateVisibility(); }
function resetGame(){ if(confirm('‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?')){ localStorage.removeItem('ls_save'); window.location.reload(); } }
function toggleSound(){ soundsOn=!soundsOn; soundBtn.textContent=soundsOn?'üîä ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ON':'üîá ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° OFF'; if(soundsOn) ambient.play().catch(()=>{}); else ambient.pause(); }
function openCredits(){ window.open('https://www.facebook.com/ahm.habib.39','_blank'); }

startBtn.addEventListener('click',startGame);
overlayStart.addEventListener('click',startGame);
saveBtn.addEventListener('click',saveGame);
loadBtn.addEventListener('click',loadGame);
resetBtn.addEventListener('click',resetGame);
soundBtn.addEventListener('click',toggleSound);
creditsBtn.addEventListener('click',openCredits);

// Target clicks
document.getElementById('fuse').addEventListener('click',(e)=>{
  if(step!==1) return;
  spawnSparks(e.clientX,e.clientY,20);
  found.fuse=true; step=1.5;
  updateVisibility(); typeHint('‡¶´‡¶ø‡¶â‡¶ú ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ó‡ßá‡¶õ‡ßá ‚Äî ‡¶¨‡¶ø‡¶°‡¶º‡¶æ‡¶≤ ‡¶∏‡¶∞‡¶æ‡¶®');
});
document.getElementById('cat').addEventListener('click',(e)=>{
  if(step!==1.5) return;
  spawnSparks(e.clientX,e.clientY,15);
  found.cat=true; step=2;
  updateVisibility(); typeHint('‡¶¨‡¶ø‡¶°‡¶º‡¶æ‡¶≤ ‡¶∏‡¶∞‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá ‚Äî ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®');
});
document.getElementById('meter').addEventListener('click',(e)=>{
  if(step!==2) return;
  spawnSparks(e.clientX,e.clientY,15);
  found.meter=true; step=3;
  updateVisibility(); typeHint('‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‚Äî ‡¶ñ‡ßÅ‡¶Å‡¶ü‡¶ø ‡¶§‡ßá ‡¶Ø‡¶æ‡¶®');
});
document.getElementById('pole').addEventListener('click',(e)=>{
  if(step!==3) return;
  spawnSparks(e.clientX,e.clientY,20);
  found.pole=true; step=4;
  updateVisibility(); typeHint('‡¶´‡¶æ‡¶á‡¶®‡¶æ‡¶≤ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‚Äî ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡ßÅ‡ßé ‡¶´‡¶ø‡¶∞‡ßá ‡¶è‡¶∏‡ßá‡¶õ‡ßá!');
  running=false; ambient.pause();
});

</script>
</body>
</html>
